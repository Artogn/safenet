<html>
<head>
  <title>SAFE Web App Sample</title>
  <script src="./lib/index.js"></script>
  <script>
    Safe.log = console.log.bind(console);

    var safe = new Safe({
      id: 'com.samp-company.web',
      name: 'Raw Safe API Example',
      vendor: 'Sample-Company',
      version: '0.1'
    }, ['SAFE_DRIVE_ACCESS']);

    // Automatically try to authenticate
    safe.auth.authenticate();

    function addError(element, error) {
      console.log(error.toString());

      element.innerHTML = error.message;
    }
  </script>
</head>
<body>
  <h1>Raw Safe API</h1>

  <h2><u>Auth</u></h2>

  <h4>Authorize</h4>
  <p><button type="button" onClick="authorize()">Authorize</button></p>
  <p id="authorizeArea"></p>
  <script>
    function authorize() {
      var responseArea = document.getElementById('authorizeArea');

      safe.auth.authenticate().then(function() {
        responseArea.innerHTML = 'Authorized successfully.';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Am I Authorized?</h4>
  <p><button type="button" onClick="isAuthorized()">Am I Authorized?</button></p>
  <p id="isAuthorizedArea"></p>
  <script>
    function isAuthorized() {
      var responseArea = document.getElementById('isAuthorizedArea');

      safe.auth.isAuthorized().then(function(bool) {
        responseArea.innerHTML = bool ? 'Authorized.' : 'Not authorized.';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Deauthorize</h4>
  <p><button type="button" onClick="deauthorize()">Deauthorize</button></p>
  <p id="deauthorizeArea"></p>
  <script>
    function deauthorize() {
      var responseArea = document.getElementById('deauthorizeArea');

      safe.auth.deauthorize().then(function() {
        responseArea.innerHTML = 'Unauthorized.';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h2><u>DNS</u></h2>

  <h4>Get Long Names</h4>
  <p><button type="button" onClick="getLongNames()">Get Long Names</button></p>
  <p id="longNamesArea"></p>
  <script>
    function getLongNames() {
      var responseArea = document.getElementById('longNamesArea');

      safe.dns.getLongNames().then(function(names) {
        responseArea.innerHTML = names.length > 0 ? names.join(', ') : 'No long names found.';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Create Long Name</h4>
  <p><input type="text" id="createLongNameBox" /> <button type="button" onClick="createLongName()">Create Long Name</button></p>
  <p id="createLongNamesArea"></p>
  <script>
    function createLongName() {
      var longName = document.getElementById('createLongNameBox').value;
      var responseArea = document.getElementById('createLongNamesArea');
      console.log('creating long name', longName);

      safe.dns.createLongName(longName).then(function() {
        responseArea.innerHTML = 'Created new long name. Use the section above to check it out.';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Create Service</h4>
  <p>
    <input type="text" id="createServiceBoxLongName" placeholder="Long Name"/><br/>
    <input type="text" id="createServiceBoxServiceName" placeholder="Service Name"/><br/>
    <input type="text" id="createServiceBoxDir" placeholder="Directory Name"/><br/>
    <button type="button" onClick="createService()">Create Service</button>
  </p>
  <p id="createServiceArea"></p>
  <script>
    function createService() {
      var payload = {
        longName: document.getElementById('createServiceBoxLongName').value,
        serviceName: document.getElementById('createServiceBoxServiceName').value,
        serviceHomeDirPath: document.getElementById('createServiceBoxServiceName').value,
        isPathShared: true // because why not
      };
      var responseArea = document.getElementById('createServiceArea');
      console.log('creating new service', payload);

      safe.dns.createService(payload).then(function() {
        responseArea.innerHTML = 'Created new service.';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Get Service Directory</h4>
  <input type="text" id="getServiceDirectoryServiceName" placeholder="Service Name"/><br/>
  <input type="text" id="getServiceDirectoryLongName" placeholder="Long Name"/><br/>
  <button type="button" onClick="getServiceDir()">Get Service Directory</button>
  <p id="getServiceDirArea"></p>
  <script>
    function getServiceDir() {
      var responseArea = document.getElementById('getServiceDirArea'),
          longName = document.getElementById('getServiceDirectoryLongName').value,
          serviceName = document.getElementById('getServiceDirectoryServiceName').value;

      safe.dns.getServiceDir(serviceName, longName).then(function(dir) {
        responseArea.innerHTML = 'Directory: '+dir;
      }, addError.bind(null, responseArea));
    }
  </script>

  <h2><u>NFS</u></h2>

  <h4>Create Directory</h4>
  <input type="text" id="createDirectory" placeholder="Directory"/>
  <button type="button" onClick="createDirectory()">Create Directory</button>
  <p id="createDirectoryArea"></p>
  <script>
    function createDirectory() {
      var responseArea = document.getElementById('createDirectoryArea'),
          createDirectory = document.getElementById('createDirectory').value;

      safe.nfs.createDirectory(createDirectory, {
        isPrivate: false,
        metadata: btoa('some meta data was put here'),
        isVersioned: true,
        isPathShared: true
      }).then(function(res) {
        console.log('Create dir response: ', res);
        responseArea.innerHTML = 'Created directory.';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Get Directory</h4>
  <input type="text" id="getDirectory" placeholder="Directory"/>
  <button type="button" onClick="getDirectory()">Get Directory</button>
  <p id="getDirectoryArea"></p>
  <script>
    function getDirectory() {
      var responseArea = document.getElementById('getDirectoryArea'),
          getDirectory = document.getElementById('getDirectory').value;

      safe.nfs.getDirectory(getDirectory, {isPathShared: 'true'}).then(function(res) {
        console.log('Get dir response: ', res);
        res.info.metadata = atob(res.info.metadata);
        responseArea.innerHTML = '<pre>'+JSON.stringify(res, null, 4)+'</pre>';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Delete Directory</h4>
  <input type="text" id="deleteDirectory" placeholder="Directory"/>
  <button type="button" onClick="deleteDirectory()">Delete Directory</button>
  <p id="deleteDirectoryArea"></p>
  <script>
    function deleteDirectory() {
      var responseArea = document.getElementById('deleteDirectoryArea'),
          deleteDirectory = document.getElementById('deleteDirectory').value;

      safe.nfs.deleteDirectory(deleteDirectory, {isPathShared: 'true'}).then(function(res) {
        console.log('Delete dir response: ', res);
        responseArea.innerHTML = 'Deleted directory.';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Create File</h4>
  <input type="text" id="createFile" placeholder="File name"/>
  <button type="button" onClick="createFile()">Create File</button>
  <p id="createFileArea"></p>
  <script>
    function createFile() {
      var responseArea = document.getElementById('createFileArea'),
          createFile = document.getElementById('createFile').value;

      safe.nfs.createFile(createFile, {
        isPrivate: false,
        metadata: btoa('some meta data was put here'),
        isVersioned: true,
        isPathShared: true
      }).then(function(response) {
        console.log('Create file response: ', response);
        responseArea.innerHTML = 'Created file. Now go add content!';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Update File</h4>
  <input type="text" id="updateFile" placeholder="File name"/><br />
  <textarea id="updateFileContents" placeholder="Contents"></textarea><br />
  <button type="button" onClick="updateFile()">Update File Contents</button>
  <p id="updateFileArea"></p>
  <script>
    function updateFile() {
      var responseArea = document.getElementById('updateFileArea'),
          updateFile = document.getElementById('updateFile').value;
          updateFileContents = document.getElementById('updateFileContents').value;

      safe.nfs.updateFile(updateFile, updateFileContents, {
        isPathShared: true
      }).then(function(response) {
        console.log('Update file response: ', response);
        responseArea.innerHTML = 'Updated file. Try fetching it now.';
      }, addError.bind(null, responseArea));
    }
  </script>

  <h4>Get File</h4>
  <input type="text" id="getFile" placeholder="File Path"/>
  <button type="button" onClick="getFile()">Get File</button>
  <p id="getFileArea"></p>
  <script>
    function getFile() {
      var responseArea = document.getElementById('getFileArea'),
          getFile = document.getElementById('getFile').value;

      safe.nfs.getFile(getFile, {isPathShared: 'true'}).then(function(res) {
        console.log('Get file response: ', res);
        responseArea.innerHTML = '<pre>'+JSON.stringify(res, null, 4)+'</pre>';
      }, addError.bind(null, responseArea));
    }
  </script>


</body>
</html>