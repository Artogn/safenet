<html>
<head>
  <title>SAFE Web App Sample</title>
  <script src="./lib/index.js"></script>
  <script>
    Safe.log = console.log.bind(console);

    var safe = new Safe({
      id: 'com.samp-company.web',
      name: 'Raw Safe API Example',
      vendor: 'Sample-Company',
      version: '0.1'
    });

    function authorize() {
      var resultArea = document.getElementById('authorizeArea');

      safe.authenticate().then(function() {
        resultArea.innerHTML = 'Authorized successfully.';
      }, function(response) {
        console.log('response', response);
        response.text().then(function(message) {
          console.log(response.status, message);
          resultArea.innerHTML = 'authorize Failed: \n status: ' + response.status + '\n Msg: ' + message;
        })
      });
    }

    function isAuthorized() {
      var longNameArea = document.getElementById('isAuthorizedArea');

      safe.isAuthorized().then(function(bool) {
        longNameArea.innerHTML = bool ? 'Authorized.' : 'Not authorized.';
      });
    }

    function deauthorize() {
      var deauthorizeArea = document.getElementById('deauthorizeArea');

      safe.deauthorize().then(function() {
        deauthorizeArea.innerHTML = 'Unauthorized.';
      }, function(error) {
        console.log(error);
        deauthorizeArea.innerHTML = error.message;
      });
    }

    function getLongNames() {
      var longNameArea = document.getElementById('longNamesArea');

      safe.getLongNames().then(function(names) {
        longNameArea.innerHTML = names.length > 0 ? names.join(', ') : 'No long names found.';
      }, function(error) {
        longNameArea.innerHTML = error.message;
      });
    }

    function createLongName() {
      var longName = document.getElementById('createLongNameBox').value;
      var createLongNamesArea = document.getElementById('createLongNamesArea');
      console.log('creating long name', longName);

      safe.createLongName(longName).then(function() {
        createLongNamesArea.innerHTML = 'Created new long name. Use the section above to check it out.';
      }, function(error) {
        createLongNamesArea.innerHTML = error.message;
      });
    }
  </script>
</head>
<body>
  <h1>Raw Safe API</h1>

  <h3>Authorize</h3>
  <p><button type="button" onClick="authorize()">Authorize</button></p>
  <p id="authorizeArea"></p>

  <h3>Am I Authorized?</h3>
  <p><button type="button" onClick="isAuthorized()">Am I Authorized?</button></p>
  <p id="isAuthorizedArea"></p>

  <h3>Get Long Names</h3>
  <p><button type="button" onClick="getLongNames()">Get Long Names</button></p>
  <p id="longNamesArea"></p>

  <h3>Create Long Name</h3>
  <p><input type="text" id="createLongNameBox" /> <button type="button" onClick="createLongName()">Create Long Name</button></p>
  <p id="createLongNamesArea"></p>

  <h3>Deauthorize</h3>
  <p><button type="button" onClick="deauthorize()">Deauthorize</button></p>
  <p id="deauthorizeArea"></p>

</body>
</html>